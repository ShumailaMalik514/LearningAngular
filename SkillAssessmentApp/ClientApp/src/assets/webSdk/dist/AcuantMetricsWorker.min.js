"use strict"; "function" == typeof importScripts && (importScripts("AcuantMetricsService.min.js"), AcuantMetricsModule().then(e => { let r = e.addFunction(n, "vff"), t = e.addFunction(i, "vff"); function n(e, r) { let t = { func: "metrics" }; e >= 0 && r >= 0 ? (t.sharpness = e, t.glare = r) : t.error = e < -.5 && e > -1.5 ? "Runtime error" : e < -1.5 && e > -2.5 ? "Metrics did not return OK" : "Unknown Error Occured", postMessage(t) } function i(e, r) { let t = { func: "moire" }; e >= 0 && r >= 0 ? (t.moire = e, t.moireraw = r) : t.error = e < -.5 && e > -1.5 ? "Runtime error" : e < -1.5 && e > -2.5 ? "Moire did not return OK" : "Unknown Error Occured", postMessage(t) } function a(r) { null != r && (e._free(r), r = null) } function o(r) { var t = e._malloc(r.length * r.BYTES_PER_ELEMENT); return e.HEAPU8.set(r, t), t } onmessage = (s => { if (s && s.data) if ("metrics" === s.data.func) { let t = s.data.data; if (t.imgData && t.width && t.height) { let n = o(t.imgData); e.ccall("acuantMetrics", null, ["number", "number", "number", "number"], [n, t.width, t.height, r]), a(n) } else console.error("missing params"), n(-1, -1) } else if ("moire" === s.data.func) { let r = s.data.data; if (r.imgData && r.width && r.height) { let n = o(r.imgData); e.ccall("acuantMoire", null, ["number", "number", "number", "number"], [n, r.width, r.height, t]), a(n) } else console.error("missing params"), i(-1, -1) } else console.error("called with no func specified") }), postMessage({ metricsWorker: "started" }) }));
